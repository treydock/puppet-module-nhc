<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Puppet Class: nhc
  
    &mdash; Documentation by YARD 0.9.20
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "puppet_classes::nhc";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../puppet_class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (n)</a> &raquo;
    <span class='title'><span class='object_link'>Puppet Classes</span></span>
     &raquo; 
    <span class="title">nhc</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="../puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Puppet Class: nhc</h1>
<div class="box_info">
  
  
  <dl>
    <dt>Defined in:</dt>
    <dd>
      manifests/init.pp
    </dd>
  </dl>
</div>

  <h2>Summary</h2>
  Manage Node Health Check (NHC)

<h2>Overview</h2>
<div class="docstring">
  <div class="discussion">
    
  </div>
</div>


<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code>include ::nhc</code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>ensure</span>
      
      
        <span class='type'>(<tt>Enum['present', 'absent']</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;present&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>State of NHC resources</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>install_method</span>
      
      
        <span class='type'>(<tt>Enum['repo','package','source']</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;package&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The method used to install NHC. Using <code>repo</code> will require the
<code>Yumrepo</code> resource if <code>repo_name</code> is defined.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>package_ensure</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The ensure state of package if using <code>install_method</code> of
<code>repo</code> or <code>package</code>.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>version</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;1.4.2&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The version of NHC to install.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>package_release</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;1&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The package release NHC to install. Not used if <code>install_method</code>
is <code>source</code>.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>install_source</span>
      
      
        <span class='type'>(<tt>Optional[Variant[Stdlib::HTTPUrl,Stdlib::HTTPSUrl]]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The source of install. For <code>install_method</code> of
<code>package</code> this is URL to package For <code>install_method</code>
of <code>source</code> this is git source URL</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>package_name</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Name of the NHC package, not used with <code>install_method</code> of
<code>source</code>.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>repo_name</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The repo name for NHC, only used with <code>install_method</code> of
<code>repo</code>.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>source_dependencies</span>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>[&#39;automake&#39;,&#39;make&#39;]</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The package dependencies for source install.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>checks</span>
      
      
        <span class='type'>(<tt>Variant[Hash, Array]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>[]</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>NHC checks for nhc.conf</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>settings</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Settings to add to nhc.conf</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>settings_host</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Host specific settings for nhc.conf</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>config_overrides</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Settings to add to /etc/sysconfig/nhc</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>detached_mode</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Value for DETACHED_MODE</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>detached_mode_fail_nodata</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Value for DETACHED_MODE_FAIL_NODATA</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>program_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;nhc&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Value for NAME</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>conf_dir</span>
      
      
        <span class='type'>(<tt>Stdlib::Absolutepath</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;/etc/nhc&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Path to NHC configuration directry</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>conf_file</span>
      
      
        <span class='type'>(<tt>Stdlib::Absolutepath</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;/etc/nhc/nhc.conf&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Path for this configuration file</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>include_dir</span>
      
      
        <span class='type'>(<tt>Stdlib::Absolutepath</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;/etc/nhc/scripts&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Path to directory containing NHC checks</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>log_file</span>
      
      
        <span class='type'>(<tt>Stdlib::Absolutepath</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;/var/log/nhc.log&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Path to log file</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>sysconfig_path</span>
      
      
        <span class='type'>(<tt>Stdlib::Absolutepath</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;/etc/sysconfig/nhc&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Path to sysconfig file</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>manage_logrotate</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Boolean that sets if logrotate resources should be managed</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>log_rotate_every</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;weekly&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Frequency of logrotation</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>custom_checks</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Hash passed to <code>nhc::custom_check</code></p>
</div>
      
    </li>
  
</ul>


</div><div class="method_details_list">
  <table class="source_code">
    <tr>
      <td>
        <pre class="lines">


58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154</pre>
      </td>
      <td>
        <pre class="code"><span class="info file"># File 'manifests/init.pp', line 58</span>

class nhc (
  Enum[&#39;present&#39;, &#39;absent&#39;] $ensure   = &#39;present&#39;,

  # packages
  Enum[&#39;repo&#39;,&#39;package&#39;,&#39;source&#39;] $install_method = &#39;package&#39;,
  Optional[String] $package_ensure      = undef,
  Optional[String] $version     = &#39;1.4.2&#39;,
  Optional[String] $package_release     = &#39;1&#39;,
  Optional[Variant[Stdlib::HTTPUrl,Stdlib::HTTPSUrl]]
    $install_source                     = undef,
  Optional[String] $package_name        = undef,
  Optional[String] $repo_name           = undef,
  Array $source_dependencies            = [&#39;automake&#39;,&#39;make&#39;],

  # NHC configuration
  Variant[Hash, Array] $checks          = [],
  Hash $settings                        = {},
  Hash $settings_host                   = {},
  Hash $config_overrides                = {},
  Boolean $detached_mode                = false,
  Boolean $detached_mode_fail_nodata    = false,
  String $program_name                  = &#39;nhc&#39;,
  Stdlib::Absolutepath $conf_dir        = &#39;/etc/nhc&#39;,
  Stdlib::Absolutepath $conf_file       = &#39;/etc/nhc/nhc.conf&#39;,
  Stdlib::Absolutepath $include_dir     = &#39;/etc/nhc/scripts&#39;,
  Stdlib::Absolutepath $log_file        = &#39;/var/log/nhc.log&#39;,
  Stdlib::Absolutepath $sysconfig_path  = &#39;/etc/sysconfig/nhc&#39;,
  Boolean $manage_logrotate             = true,
  String $log_rotate_every              = &#39;weekly&#39;,
  Hash $custom_checks                   = {},
) {

  $osfamily = dig($facts, &#39;os&#39;, &#39;family&#39;)
  if ! ($osfamily in [&#39;RedHat&#39;]) {
    fail(&quot;Unsupported osfamily: ${osfamily}, module ${module_name} only supports RedHat&quot;)
  }

  case $ensure {
    &#39;present&#39;: {
      if $install_method == &#39;repo&#39; {
        $_package_ensure  = pick($package_ensure, &quot;${version}-${package_release}.el${facts[&#39;os&#39;][&#39;release&#39;][&#39;major&#39;]}&quot;)
      } else {
        $_package_ensure  = pick($package_ensure, &#39;installed&#39;)
      }
      $directory_ensure = &#39;directory&#39;
      $_directory_force = undef
      $file_ensure      = &#39;file&#39;
    }
    &#39;absent&#39;: {
      $_package_ensure  = &#39;absent&#39;
      $directory_ensure = &#39;absent&#39;
      $_directory_force = true
      $file_ensure      = &#39;absent&#39;
    }
    default: {}
  }

  if $install_method == &#39;repo&#39; {
    if $repo_name {
      $_package_require = Yumrepo[$repo_name]
    } else {
      $_package_require = undef
    }
    $_install_source              = undef
    $_package_name                = pick($package_name, &#39;lbnl-nhc&#39;)
  } elsif $install_method == &#39;package&#39; {
    $_default_package_name   = &quot;lbnl-nhc-${version}-${package_release}.el${facts[&#39;os&#39;][&#39;release&#39;][&#39;major&#39;]}.noarch&quot;
    $_default_install_source = &quot;https://github.com/mej/nhc/releases/download/${version}/${_default_package_name}.rpm&quot;
    $_package_require             = undef
    $_install_source = pick($install_source, $_default_install_source)
    $_package_name = pick($package_name, $_default_package_name)
  } else {
    $_install_source = pick($install_source, &#39;https://github.com/mej/nhc.git&#39;)
  }

  $default_configs = {
    &#39;CONFDIR&#39;                   =&gt; $conf_dir,
    &#39;CONFFILE&#39;                  =&gt; $conf_file,
    &#39;DETACHED_MODE&#39;             =&gt; $detached_mode,
    &#39;DETACHED_MODE_FAIL_NODATA&#39; =&gt; $detached_mode_fail_nodata,
    &#39;INCDIR&#39;                    =&gt; $include_dir,
    &#39;NAME&#39;                      =&gt; $program_name,
  }

  $configs = merge($default_configs, $config_overrides)

  contain ::nhc::install
  contain ::nhc::config

  Class[&#39;nhc::install&#39;]
  -&gt; Class[&#39;nhc::config&#39;]

  $custom_checks.each |$name, $params| {
    ::nhc::custom_check { $name: * =&gt; $params }
  }

}</pre>
      </td>
    </tr>
  </table>
</div>
</div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>